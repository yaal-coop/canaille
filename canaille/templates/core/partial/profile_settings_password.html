{% import 'core/partial/profile_field.html' as profile_field %}

<h2 class="ui center aligned header">
    <div class="content">
        {% trans %}Password{% endtrans %}
    </div>
</h2>
<div class="ui info message">
    {% trans %}
        You can change your password here by typing it once in each field below.
        The longer the password, the stronger it is. A good password is a
        long password that you will remember, not a complicated password that your
        use for all your accounts.
    {% endtrans %}
</div>

{% if "password1" in form %}
    {% block password_field scoped %}
        <div class="two fields">
            {{ profile_field.render_field(form.password1, user=user, edited_user=edited_user, noindicator=true) }}
            {{ profile_field.render_field(form.password2, user=user, edited_user=edited_user, noindicator=true) }}
        </div>
    {% endblock %}
{% endif %}

{% if user.can_manage_users %}

    {% if not edited_user.has_password() %}

        <div class="ui message warning visible">
            {% if features.has_smtp and edited_user.can_edit_self %}
                <button type="submit" name="action" value="password-initialization-mail" class="ui right floated primary button">
                    {% trans %}Send mail{% endtrans %}
                </button>
            {% endif %}
            <div class="header">
                {% trans %}This user does not have a password yet{% endtrans %}
            </div>
            {% if features.has_smtp and edited_user.can_edit_self %}
                <p>{% trans %}You can solve this by:{% endtrans %}</p>
                <ul class="ui list">
                    <li>{% trans %}setting a password using this form;{% endtrans %}</li>
                    <li>{% trans %}sending the user a password initialization mail, by clicking this button;{% endtrans %}</li>
                    <li>{% trans %}or simply waiting for the user to sign-in a first time, and then receive a password initialization mail.{% endtrans %}</li>
                </ul>
            {% else %}
                <p>{% trans %}The user will not be able to authenticate unless the password is set{% endtrans %}</p>
            {% endif %}
        </div>

    {% elif features.has_smtp and edited_user.user_name != user.user_name and edited_user.has_password() and edited_user.can_edit_self %}

        <div class="ui message info">
            <button type="submit" name="action" value="password-reset-mail" class="ui right floated button">
                {% trans %}Send mail{% endtrans %}
            </button>
            <div class="header">
                {% trans %}Password reset{% endtrans %}
            </div>
            <p>{% trans %}If the user has forgotten his password, you can send him a password reset email by clicking this button.{% endtrans %}</p>
        </div>

    {% endif %}

    {% if features.has_account_lockability and edited_user.locked %}

        <div class="ui message warning visible">
            <button type="submit" name="action" value="unlock" class="ui right floated button">
                {% trans %}Unlock{% endtrans %}
            </button>
            <div class="header">
                {% trans %}This user account is locked{% endtrans %}
            </div>
            <p>
                {% trans %}The user won't be able to connect until their account is unlocked.{% endtrans %}
            </p>
        </div>

    {% endif %}

{% endif %}

<div class="ui right aligned container">
    <div class="ui stackable buttons">
        <button type="submit" class="ui right floated primary button" name="action" value="edit-settings" id="edit-settings">
            {{ _("Edit") }}
        </button>
    </div>
</div>
