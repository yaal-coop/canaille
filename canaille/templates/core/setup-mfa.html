{# The multi-factor authentication initialization template.

Display a QR-code and the OTP secret.

:param user: The user initializing the OTP.
:type user: :class:`~canaille.core.models.User`
:param secret: The OTP secret.
:type secret: :class:`str`
:param qr_image: A QR-code image representing the OTP secret.
:type qr_image: A base64 encoded :class:`str`
#}
{% extends theme('base.html') %}
{% import 'macro/flask.html' as flask %}
{% import 'macro/form.html' as fui %}
{% import 'core/partial/login_field.html' as login_field %}

{% block script %}
    <script src="{{ url_for("static", filename="js/copy.js") }}" defer></script>
{% endblock %}

{% block container %}
    <div class="ui container">
        <div class="content">
            <div class="ui clearing segment">
                {% block header %}
                    {% if logo_url %}
                        <a href="{{ url_for('core.account.index') }}">
                            <img class="ui tiny centered image" src="{{ logo_url }}" alt="{{ website_name }}">
                        </a>
                    {% else %}
                        <i class="massive sign in icon image ui"></i>
                    {% endif %}

                    <h2 class="ui center aligned header">
                        <div class="content">
                            {{ _("Sign in as %(username)s", username=user.user_name) }}
                        </div>
                        <div class="sub header">{% trans %}Set up multi-factor authentication.{% endtrans %}</div>
                    </h2>
                {% endblock %}

                {% block messages %}
                    {{ flask.messages() }}
                {% endblock %}

                <div class="ui segment">
                    <h3 class="ui header">{% trans %}Instructions{% endtrans %}</h3>
                    <ol class="ui list">
                        <li class="item">{% trans %}Install a One-Time Password (OTP) generator application on your mobile.{% endtrans %}</li>
                        <li class="item">{% trans %}Set up a new authenticator.{% endtrans %}</li>
                        <li class="item">{% trans %}Scan the QR code below and click "Continue".{% endtrans %}</li>
                    </ol>
                    <p>
                        <strong>{% trans %}Note:{% endtrans %}</strong>
                        {% trans %}If you can't scan the QR code, try entering the secret token in your authenticator app directly.{% endtrans %}
                    </p>
                </div>

                <div>
                    <a href="{{ otp_uri }}">
                        <img src="data:image/png;base64, {{ qr_image }}" alt="{% trans %}Secret token{% endtrans %}" class="ui centered medium image"/>
                    </a>
                </div>

                <br>

                <div class="ui fluid labeled action input">
                    <label class="ui label" for="secret">{% trans %}Secret token{% endtrans %}</label>
                    <input class="copy-text" type="text" id="secret" name="secret" value="{{ secret }}" readonly data-copy="secret">
                    <button type="button" class="ui secondary icon button copy-button" data-copy="secret">
                        <i class="copy icon"></i>
                        {% trans %}Copy secret{% endtrans %}
                    </button>
                </div>

                <br>

                {% block buttons %}
                    <div class="ui right aligned container">
                        <div class="ui stackable buttons">
                            <a type="button"class="ui right button" href="{{ otp_uri }}">
                                {% trans %}Open authenticator application{% endtrans %}
                            </a>
                            <a type="button" class="ui right primary button" href="{{ url_for('core.auth.verify_two_factor_auth') }}">
                                {{ _("Continue") }}
                            </a>
                        </div>
                    </div>
                {% endblock %}
            </div>
        </div>
    </div>
{% endblock %}
