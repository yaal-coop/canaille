{# WebAuthn security keys management partial.

Displays the security keys section in profile settings.

:param edited_user: The user being edited.
:type edited_user: :class:`~canaille.core.models.User`
#}
<h2 class="ui center aligned header">
    <div class="content">
        {% trans %}Security keys{% endtrans %}
    </div>
</h2>

{% if edited_user.webauthn_credentials %}
    <div class="ui top attached info message">
        <div class="header">
            {% trans count=edited_user.webauthn_credentials|length %}
                You have {{ count }} security key configured.
                {% pluralize %}
                You have {{ count }} security keys configured.
            {% endtrans %}
        </div>
        <p>
            {% trans %}
                Security keys can be used for authentication.
            {% endtrans %}
            {% if edited_user.webauthn_credentials|length < 2 %}
                {% trans %}
                    As they are unrecoverable in case of loss,
                    it is generally recommended to register at least one additional backup key.
                {% endtrans %}
            {% endif %}
        </p>
    </div>

    <table class="ui bottom attached celled table">
        <thead>
            <tr>
                <th>{% trans %}Name{% endtrans %}</th>
                <th>{% trans %}Registered{% endtrans %}</th>
                <th>{% trans %}Last used{% endtrans %}</th>
                <th>{% trans %}Actions{% endtrans %}</th>
            </tr>
        </thead>
        <tbody>
            {% for credential in edited_user.webauthn_credentials %}
                <tr>
                    <td>
                        <div class="ui action input" style="width: 100%;">
                            <input type="text" name="credential_name_{{ credential.id }}" value="{{ credential.name or _('My security key') }}" maxlength="255">
                            <button type="submit" class="ui icon button" name="rename_credential" value="{{ credential.id }}" formnovalidate title="{% trans %}Rename{% endtrans %}">
                                <i class="edit icon"></i>
                            </button>
                        </div>
                    </td>
                    <td>{{ credential.created_at|datetimeformat }}</td>
                    <td>
                        {% if credential.last_used_at %}
                            {{ credential.last_used_at|datetimeformat }}
                        {% else %}
                            <em>{% trans %}Never{% endtrans %}</em>
                        {% endif %}
                    </td>
                    <td>
                        <button type="submit" class="ui basic negative icon button" name="confirm_credential" value="{{ credential.id }}" formnovalidate title="{% trans %}Delete{% endtrans %}">
                            <i class="trash icon"></i>
                        </button>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

    <div class="ui right aligned container">
        <div class="ui stackable buttons">
            {% if edited_user.webauthn_credentials|length < config.CANAILLE.FIDO_MAX_CREDENTIALS %}
                <button type="submit" class="ui primary button" name="action" value="setup-fido2" id="setup-fido2" formnovalidate>
                    <i class="plus icon"></i>
                    {% trans %}Add another key{% endtrans %}
                </button>
            {% else %}
                <div class="ui disabled button" title="{% trans max=config.CANAILLE.FIDO_MAX_CREDENTIALS %}Maximum limit reached ({{ max }}){% endtrans %}">
                    <i class="plus icon"></i>
                    {% trans %}Add another key{% endtrans %}
                </div>
            {% endif %}
            <button type="submit" class="ui basic negative button confirm" name="action" value="confirm-reset-fido2" id="reset-fido2-all" formnovalidate>
                {% trans %}Remove all keys{% endtrans %}
            </button>
        </div>
    </div>

{% else %}

    <div class="ui info message">
        {% trans %}
            You have no security key configured.
            Click on the following button to register your security key.
        {% endtrans %}
    </div>
    <div class="ui right aligned container">
        <div class="ui stackable buttons">
            <button type="submit" class="ui right floated primary button" name="action" value="setup-fido2" id="setup-fido2" formnovalidate>
                {% trans %}Set-up{% endtrans %}
            </button>
        </div>
    </div>

{% endif %}
